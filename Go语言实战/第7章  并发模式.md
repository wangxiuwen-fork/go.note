











#第 7 章 并发模式 150 

本章主要内容 

 控制程序的生命周期 

 管理可复用的资源池 

 创建可以处理任务的 goroutine 池 

	在第 6 章中， 我们学习了什么是并发，通道是如何工作的，并学习了可以实际工作的并发代 码。本章将通过学习更多代码来扩展这些知识。我们会学习 3 个可以在实际工程里使用的包，这 3 个包分别实现了不同的并发模式。每个包从一个实用的视角来讲解如何使用并发和通道。我们 会学习如何用这个包简化并发程序的编写，以及为什么能简化的原因。  

##7.1 runner 150  

	runner 包用于展示如何使用通道来监视程序的执行时间，如果程序运行时间太长，也可以 用 runner 包来终止程序。当开发需要调度后台处理任务的程序的时候，这种模式会很有用。这 个程序可能会作为 cron 作业执行，或者在基于定时任务的云环境（如 iron.io） 里执行。 让我们来看一下 runner 包里的 runner.go 代码文件，如代码清单 7-1 所示。

  

##7.2 pool 158 



##7.3 work 168 



##7.4 小结 

可以使用通道来控制程序的生命周期。 

带 default 分支的 select 语句可以用来尝试向通道发送或者接收数据，而不会阻塞。 

有缓冲的通道可以用来管理一组可复用的资源。 

语言运行时会处理好通道的协作和同步。

 使用无缓冲的通道来创建完成工作的 goroutine 池。 

任何时间都可以用无缓冲的通道来让两个 goroutine 交换数据，在通道操作完成时一定保 证对方接收到了数据。  